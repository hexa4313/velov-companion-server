worker_processes 4;

events { worker_connections 1024; }

http {

    #upstream node-app {
    #      least_conn;
    #      server node1:8080 weight=10 max_fails=3 fail_timeout=30s;
    #      server node2:8080 weight=10 max_fails=3 fail_timeout=30s;
    #      server node3:8080 weight=10 max_fails=3 fail_timeout=30s;
    #}

    server {
          listen 80;
          add_header 'Access-Control-Allow-Origin' '*';
          add_header 'Access-Control-Allow-Credentials' 'true';
          add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';

          #location / {
          #  proxy_pass http://node-app;
          #  proxy_http_version 1.1;
          #  proxy_set_header Upgrade $http_upgrade;
          #  proxy_set_header Connection 'upgrade';
          #  proxy_set_header Host $host;
          #  proxy_cache_bypass $http_upgrade;
          #}

          location ~^/autocomplete {
              proxy_pass http://photon.komoot.de/api/$is_args$args;
          }

          location /brouter {
              proxy_pass http://brouter:17777;
          }

          location / {
              proxy_pass http://flask:5000;
          }
    }
}

